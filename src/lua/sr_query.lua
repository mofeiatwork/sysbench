
require("oltp_common")

sysbench.cmdline.commands.prepare = {
   function ()
      if (not sysbench.opt.auto_inc) then
         -- Create empty tables on prepare when --auto-inc is off, since IDs
         -- generated on prepare may collide later with values generated by
         -- sysbench.rand.unique()
         sysbench.opt.table_size=0
      end

      cmd_prepare()
   end,
   sysbench.cmdline.PARALLEL_COMMAND
}

function prepare_statements()
    -- con:query("set enable_pipeline_engine = false")
    -- con:query("set parallel_fragment_exec_instance_num = 8")
    
    con:query("set enable_pipeline_engine = true")
    con:query("set pipeline_dop = 0")
end

function event()
    local sql =sysbench.opt.srquery
    con:query(sql)
    check_reconnect()
end